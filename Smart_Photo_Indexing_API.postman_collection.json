{
  "info": {
    "name": "Smart Photo Indexing API",
    "description": "API для поиска фотографий по тексту, изображению и удаления дубликатов с поддержкой нескольких CLIP моделей",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8000",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Health & Status",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Проверка здоровья API и доступности сервисов"
          }
        },
        {
          "name": "Get Available Models",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/models",
              "host": ["{{base_url}}"],
              "path": ["models"]
            },
            "description": "Получить список доступных CLIP моделей с данными в БД"
          }
        },
        {
          "name": "Get Stats",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/stats",
              "host": ["{{base_url}}"],
              "path": ["stats"]
            },
            "description": "Статистика индексирования по всем моделям"
          }
        }
      ]
    },
    {
      "name": "Search",
      "item": [
        {
          "name": "Search by Text",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"кошка на диване\",\n  \"top_k\": 10,\n  \"similarity_threshold\": 0.1,\n  \"translate\": true,\n  \"model\": \"ViT-L/14\",\n  \"formats\": [\"jpg\", \"nef\", \"heic\"]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/search/text",
              "host": ["{{base_url}}"],
              "path": ["search", "text"]
            },
            "description": "Поиск фотографий по текстовому описанию с автоматическим переводом на английский"
          }
        },
        {
          "name": "Search by Text (SigLIP)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"beach sunset\",\n  \"top_k\": 5,\n  \"similarity_threshold\": 0.2,\n  \"translate\": false,\n  \"model\": \"SigLIP\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/search/text",
              "host": ["{{base_url}}"],
              "path": ["search", "text"]
            },
            "description": "Поиск с использованием SigLIP модели"
          }
        },
        {
          "name": "Search by Image",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": []
                },
                {
                  "key": "top_k",
                  "value": "10",
                  "type": "text"
                },
                {
                  "key": "similarity_threshold",
                  "value": "0.1",
                  "type": "text"
                },
                {
                  "key": "model",
                  "value": "ViT-L/14",
                  "type": "text",
                  "description": "Опционально: ViT-B/32, ViT-B/16, ViT-L/14, SigLIP"
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}/search/image",
              "host": ["{{base_url}}"],
              "path": ["search", "image"]
            },
            "description": "Поиск похожих фотографий по загруженному изображению"
          }
        }
      ]
    },
    {
      "name": "Photos",
      "item": [
        {
          "name": "Get Photo Info",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/photo/:image_id",
              "host": ["{{base_url}}"],
              "path": ["photo", ":image_id"],
              "variable": [
                {
                  "key": "image_id",
                  "value": "your-image-id-here"
                }
              ]
            },
            "description": "Получить метаданные фотографии по ID"
          }
        },
        {
          "name": "Get Thumbnail",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/image/:image_id/thumb",
              "host": ["{{base_url}}"],
              "path": ["image", ":image_id", "thumb"],
              "variable": [
                {
                  "key": "image_id",
                  "value": "your-image-id-here"
                }
              ]
            },
            "description": "Получить миниатюру изображения (400px, быстрая загрузка для RAW)"
          }
        },
        {
          "name": "Get Full Image",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/image/:image_id/full",
              "host": ["{{base_url}}"],
              "path": ["image", ":image_id", "full"],
              "variable": [
                {
                  "key": "image_id",
                  "value": "your-image-id-here"
                }
              ]
            },
            "description": "Получить полное изображение (макс 2000px, полное качество для RAW)"
          }
        },
        {
          "name": "Delete Photos",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"image_ids\": [\n    \"image-id-1\",\n    \"image-id-2\"\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/photos/delete",
              "host": ["{{base_url}}"],
              "path": ["photos", "delete"]
            },
            "description": "Удалить фотографии (переместить в корзину)"
          }
        }
      ]
    },
    {
      "name": "Indexing",
      "item": [
        {
          "name": "Start Reindex (Default Model)",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/reindex",
              "host": ["{{base_url}}"],
              "path": ["reindex"]
            },
            "description": "Запустить переиндексацию с моделью по умолчанию (из настроек)"
          }
        },
        {
          "name": "Start Reindex (Specific Model)",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/reindex?model=SigLIP",
              "host": ["{{base_url}}"],
              "path": ["reindex"],
              "query": [
                {
                  "key": "model",
                  "value": "SigLIP",
                  "description": "ViT-B/32, ViT-B/16, ViT-L/14, SigLIP"
                }
              ]
            },
            "description": "Запустить переиндексацию с указанной CLIP моделью"
          }
        },
        {
          "name": "Reindex Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/reindex/status",
              "host": ["{{base_url}}"],
              "path": ["reindex", "status"]
            },
            "description": "Статус фоновой переиндексации с прогрессом"
          }
        },
        {
          "name": "Reindex Files (from fast_reindex.py)",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file_list",
                  "type": "file",
                  "src": [],
                  "description": "Gzipped JSON array of file paths (files.json.gz)"
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}/reindex/files?model=SigLIP",
              "host": ["{{base_url}}"],
              "path": ["reindex", "files"],
              "query": [
                {
                  "key": "model",
                  "value": "SigLIP",
                  "description": "CLIP model: ViT-B/32, ViT-B/16, ViT-L/14, SigLIP"
                }
              ]
            },
            "description": "Запустить индексацию для списка файлов (используется fast_reindex.py). Принимает gzip-сжатый JSON массив путей."
          }
        },
        {
          "name": "Cleanup Orphaned Records",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file_list",
                  "type": "file",
                  "src": [],
                  "description": "Gzipped JSON array of Docker paths to delete (orphaned.json.gz). Omit to check all files (slow)."
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}/cleanup/orphaned",
              "host": ["{{base_url}}"],
              "path": ["cleanup", "orphaned"]
            },
            "description": "Удалить записи в БД для файлов, которых больше нет на диске. Fast mode: передать gzip-сжатый JSON массив путей (используется fast_reindex.py). Slow mode: без file_list - проверить все файлы на диске."
          }
        },
        {
          "name": "Get Unindexed Files",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/files/unindexed?model=ViT-L/14",
              "host": ["{{base_url}}"],
              "path": ["files", "unindexed"],
              "query": [
                {
                  "key": "model",
                  "value": "ViT-L/14",
                  "description": "CLIP model (опционально, по умолчанию из настроек)"
                }
              ]
            },
            "description": "Получить список файлов без эмбеддингов для указанной модели"
          }
        },
        {
          "name": "Get Scan Checkpoint",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/scan/checkpoint/H:",
              "host": ["{{base_url}}"],
              "path": ["scan", "checkpoint", "H:"]
            },
            "description": "Получить USN checkpoint для диска (для NTFS USN Journal tracking)"
          }
        },
        {
          "name": "Save Scan Checkpoint",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"drive_letter\": \"H:\",\n  \"last_usn\": 12345678,\n  \"files_count\": 102646\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/scan/checkpoint",
              "host": ["{{base_url}}"],
              "path": ["scan", "checkpoint"]
            },
            "description": "Сохранить USN checkpoint для диска (используется fast_reindex.py)"
          }
        }
      ]
    },
    {
      "name": "Duplicates",
      "item": [
        {
          "name": "Find Duplicates",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"threshold\": 0.98,\n  \"limit\": 50000,\n  \"path_filter\": \"%/2024/%\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/duplicates",
              "host": ["{{base_url}}"],
              "path": ["duplicates"]
            },
            "description": "Найти дубликаты по косинусному сходству CLIP эмбеддингов"
          }
        },
        {
          "name": "Delete Duplicates (All)",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/duplicates?threshold=0.98",
              "host": ["{{base_url}}"],
              "path": ["duplicates"],
              "query": [
                {
                  "key": "threshold",
                  "value": "0.98",
                  "description": "Порог сходства (0.9-1.0)"
                }
              ]
            },
            "description": "Найти и удалить все дубликаты"
          }
        },
        {
          "name": "Delete Duplicates (Filtered by Path)",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/duplicates?threshold=1.0&path_filter=*/2024/*",
              "host": ["{{base_url}}"],
              "path": ["duplicates"],
              "query": [
                {
                  "key": "threshold",
                  "value": "1.0",
                  "description": "Порог сходства"
                },
                {
                  "key": "path_filter",
                  "value": "*/2024/*",
                  "description": "Фильтр по пути (* заменяется на %)"
                }
              ]
            },
            "description": "Удалить дубликаты только в указанной папке"
          }
        },
        {
          "name": "Move Photos to Trash by Text Query",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"a digital graphic with text and UI elements\",\n  \"top_k\": 50,\n  \"similarity_threshold\": 0.1,\n  \"translate\": true,\n  \"model\": \"ViT-L/14\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/photos/move-to-trash",
              "host": ["{{base_url}}"],
              "path": ["photos", "move-to-trash"]
            },
            "description": "Переместить фотографии в корзину по текстовому запросу. Использует CLIP поиск и перемещает найденные файлы с сохранением структуры папок. Индексы в БД НЕ удаляются."
          }
        }
      ]
    },
    {
      "name": "pHash Duplicate Detection",
      "item": [
        {
          "name": "Find Duplicates by pHash",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"threshold\": 0,\n  \"limit\": 50000,\n  \"path_filter\": null,\n  \"all_types\": false\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/duplicates/phash",
              "host": ["{{base_url}}"],
              "path": ["duplicates", "phash"]
            },
            "description": "Найти дубликаты по perceptual hash (Hamming distance). threshold=0 — точные дубликаты, <=6 — near-duplicates (ресайзы, перекодировки). Точнее CLIP для настоящих дубликатов."
          }
        },
        {
          "name": "Find Near-Duplicates by pHash",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"threshold\": 4,\n  \"limit\": 50000,\n  \"path_filter\": \"%/2024/%\",\n  \"all_types\": false\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/duplicates/phash",
              "host": ["{{base_url}}"],
              "path": ["duplicates", "phash"]
            },
            "description": "Найти near-duplicates с Hamming distance <= 4 в указанной папке. Ловит ресайзы и перекодировки."
          }
        },
        {
          "name": "Delete Duplicates by pHash",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/duplicates/phash?threshold=0&path_filter=",
              "host": ["{{base_url}}"],
              "path": ["duplicates", "phash"],
              "query": [
                {
                  "key": "threshold",
                  "value": "0",
                  "description": "Hamming distance (0=exact, <=6=near-dupes)"
                },
                {
                  "key": "path_filter",
                  "value": "",
                  "description": "SQL LIKE filter (опционально)"
                }
              ]
            },
            "description": "Найти дубликаты по pHash и переместить в .photo_duplicates. Сохраняет отчёт и удаляет записи из БД."
          }
        },
        {
          "name": "Start pHash Reindex",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/phash/reindex?batch_size=100",
              "host": ["{{base_url}}"],
              "path": ["phash", "reindex"],
              "query": [
                {
                  "key": "batch_size",
                  "value": "100",
                  "description": "Файлов на батч (default: 100)"
                }
              ]
            },
            "description": "Вычислить pHash для всех фото без хэша (фоновая задача в Docker)"
          }
        },
        {
          "name": "pHash Reindex Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/phash/reindex/status",
              "host": ["{{base_url}}"],
              "path": ["phash", "reindex", "status"]
            },
            "description": "Статус вычисления pHash: running, computed, pending, speed, ETA (читает из БД)"
          }
        },
        {
          "name": "Stop pHash Reindex",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/phash/reindex/stop",
              "host": ["{{base_url}}"],
              "path": ["phash", "reindex", "stop"]
            },
            "description": "Остановить фоновое вычисление pHash. Прогресс сохранён — можно продолжить позже."
          }
        },
        {
          "name": "Get Pending Files (for host script)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/phash/pending?limit=5000",
              "host": ["{{base_url}}"],
              "path": ["phash", "pending"],
              "query": [
                {
                  "key": "limit",
                  "value": "5000",
                  "description": "Макс. количество файлов"
                }
              ]
            },
            "description": "Получить файлы без pHash для вычисления на хосте (используется scripts/compute_phash.py)"
          }
        },
        {
          "name": "Batch Update pHash (from host script)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"hashes\": {\n    \"12345\": \"a1b2c3d4e5f6a7b8\",\n    \"12346\": \"b2c3d4e5f6a7b8c9\"\n  },\n  \"failed\": [12347, 12348]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/phash/update",
              "host": ["{{base_url}}"],
              "path": ["phash", "update"]
            },
            "description": "Массовое обновление pHash от хост-скрипта. hashes: {image_id: phash_hex}, failed: [image_ids] — помечаются как failed (phash='')"
          }
        }
      ]
    },
    {
      "name": "Face Detection & Indexing",
      "item": [
        {
          "name": "Start Face Reindex",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/faces/reindex?skip_indexed=true&batch_size=8",
              "host": ["{{base_url}}"],
              "path": ["faces", "reindex"],
              "query": [
                {
                  "key": "skip_indexed",
                  "value": "true",
                  "description": "Пропустить уже проиндексированные фото"
                },
                {
                  "key": "batch_size",
                  "value": "8",
                  "description": "Количество воркеров для параллельной обработки на GPU"
                }
              ]
            },
            "description": "Запустить индексацию лиц в фоновом режиме"
          }
        },
        {
          "name": "Get Face Reindex Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/faces/reindex/status",
              "host": ["{{base_url}}"],
              "path": ["faces", "reindex", "status"]
            },
            "description": "Статус фоновой индексации лиц с прогрессом"
          }
        },
        {
          "name": "Get Photo Faces",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/photo/:image_id/faces",
              "host": ["{{base_url}}"],
              "path": ["photo", ":image_id", "faces"],
              "variable": [
                {
                  "key": "image_id",
                  "value": "123"
                }
              ]
            },
            "description": "Получить все лица на фотографии с bbox координатами, полом, возрастом и привязками к персонам"
          }
        },
        {
          "name": "Get Face Stats",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/faces/stats",
              "host": ["{{base_url}}"],
              "path": ["faces", "stats"]
            },
            "description": "Статистика по лицам и персонам: всего лиц, назначенных, неназначенных, персон, фото с лицами"
          }
        },
        {
          "name": "Get Face Thumbnail",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/faces/:face_id/thumb",
              "host": ["{{base_url}}"],
              "path": ["faces", ":face_id", "thumb"],
              "variable": [
                {
                  "key": "face_id",
                  "value": "123"
                }
              ]
            },
            "description": "Получить миниатюру лица (160x160 JPEG), обрезанную из фотографии по bbox с 20% padding"
          }
        },
        {
          "name": "Auto-Assign Faces on Photo",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/photo/:image_id/faces/auto-assign?threshold=0.6",
              "host": ["{{base_url}}"],
              "path": ["photo", ":image_id", "faces", "auto-assign"],
              "query": [
                {
                  "key": "threshold",
                  "value": "0.6",
                  "description": "Минимальное сходство для авто-привязки (0.3-0.95)"
                }
              ],
              "variable": [
                {
                  "key": "image_id",
                  "value": "123"
                }
              ]
            },
            "description": "Автоматически привязать неназначенные лица на фото к известным персонам. Использует все лица персон для сравнения. Обновляет cover_face_id если найдено лицо лучшего качества."
          }
        }
      ]
    },
    {
      "name": "Face Search",
      "item": [
        {
          "name": "Search by Face (Upload Image)",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": [],
                  "description": "Фото с лицом для поиска"
                },
                {
                  "key": "top_k",
                  "value": "10",
                  "type": "text"
                },
                {
                  "key": "similarity_threshold",
                  "value": "0.5",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}/search/face",
              "host": ["{{base_url}}"],
              "path": ["search", "face"]
            },
            "description": "Поиск фотографий по загруженному лицу. Система найдет похожие лица в базе."
          }
        },
        {
          "name": "Search by Face ID",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/search/face/by_id/:face_id?top_k=10&similarity_threshold=0.5",
              "host": ["{{base_url}}"],
              "path": ["search", "face", "by_id", ":face_id"],
              "query": [
                {
                  "key": "top_k",
                  "value": "10"
                },
                {
                  "key": "similarity_threshold",
                  "value": "0.5"
                }
              ],
              "variable": [
                {
                  "key": "face_id",
                  "value": "123"
                }
              ]
            },
            "description": "Найти похожие лица по ID известного лица из базы"
          }
        }
      ]
    },
    {
      "name": "Person Management",
      "item": [
        {
          "name": "List Persons",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/persons?search=&limit=100&offset=0",
              "host": ["{{base_url}}"],
              "path": ["persons"],
              "query": [
                {
                  "key": "search",
                  "value": "",
                  "description": "Поиск по имени (опционально)"
                },
                {
                  "key": "limit",
                  "value": "100"
                },
                {
                  "key": "offset",
                  "value": "0"
                }
              ]
            },
            "description": "Получить список всех персон с количеством лиц и фотографий"
          }
        },
        {
          "name": "Create Person",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Иван Иванов\",\n  \"description\": \"Описание персоны\",\n  \"initial_face_id\": 123\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/persons",
              "host": ["{{base_url}}"],
              "path": ["persons"]
            },
            "description": "Создать новую персону с опциональной привязкой к начальному лицу"
          }
        },
        {
          "name": "Get Person Details",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/persons/:person_id",
              "host": ["{{base_url}}"],
              "path": ["persons", ":person_id"],
              "variable": [
                {
                  "key": "person_id",
                  "value": "1"
                }
              ]
            },
            "description": "Получить детальную информацию о персоне с образцами лиц"
          }
        },
        {
          "name": "Update Person",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Иван Петрович Иванов\",\n  \"description\": \"Обновленное описание\",\n  \"cover_face_id\": 456\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/persons/:person_id",
              "host": ["{{base_url}}"],
              "path": ["persons", ":person_id"],
              "variable": [
                {
                  "key": "person_id",
                  "value": "1"
                }
              ]
            },
            "description": "Обновить информацию о персоне"
          }
        },
        {
          "name": "Delete Person",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/persons/:person_id",
              "host": ["{{base_url}}"],
              "path": ["persons", ":person_id"],
              "variable": [
                {
                  "key": "person_id",
                  "value": "1"
                }
              ]
            },
            "description": "Удалить персону (лица становятся неназначенными)"
          }
        },
        {
          "name": "Merge Persons",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/persons/:person_id/merge/:target_person_id",
              "host": ["{{base_url}}"],
              "path": ["persons", ":person_id", "merge", ":target_person_id"],
              "variable": [
                {
                  "key": "person_id",
                  "value": "2",
                  "description": "ID персоны для объединения (будет удалена)"
                },
                {
                  "key": "target_person_id",
                  "value": "1",
                  "description": "ID целевой персоны (все лица будут перенесены сюда)"
                }
              ]
            },
            "description": "Объединить две персоны (перенести все лица из source в target, source удалится)"
          }
        },
        {
          "name": "Get Person Photos",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/persons/:person_id/photos?limit=100&offset=0",
              "host": ["{{base_url}}"],
              "path": ["persons", ":person_id", "photos"],
              "query": [
                {
                  "key": "limit",
                  "value": "100"
                },
                {
                  "key": "offset",
                  "value": "0"
                }
              ],
              "variable": [
                {
                  "key": "person_id",
                  "value": "1"
                }
              ]
            },
            "description": "Получить все фотографии с этой персоной"
          }
        },
        {
          "name": "Recalculate Cover Faces (Maintenance)",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/persons/maintenance/recalculate-covers",
              "host": ["{{base_url}}"],
              "path": ["persons", "maintenance", "recalculate-covers"]
            },
            "description": "Пересчитать cover_face_id для всех персон на основе лучшего det_score. Использовать после миграции или для фикса cover_face_id, установленных на лица с низким качеством."
          }
        }
      ]
    },
    {
      "name": "Face-Person Assignment",
      "item": [
        {
          "name": "Assign Face to Person",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"person_id\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/faces/:face_id/assign",
              "host": ["{{base_url}}"],
              "path": ["faces", ":face_id", "assign"],
              "variable": [
                {
                  "key": "face_id",
                  "value": "123"
                }
              ]
            },
            "description": "Привязать лицо к существующей персоне"
          }
        },
        {
          "name": "Assign Face to New Person",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"new_person_name\": \"Новое имя\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/faces/:face_id/assign",
              "host": ["{{base_url}}"],
              "path": ["faces", ":face_id", "assign"],
              "variable": [
                {
                  "key": "face_id",
                  "value": "123"
                }
              ]
            },
            "description": "Создать новую персону и привязать лицо к ней"
          }
        },
        {
          "name": "Unassign Face",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/faces/:face_id/assign",
              "host": ["{{base_url}}"],
              "path": ["faces", ":face_id", "assign"],
              "variable": [
                {
                  "key": "face_id",
                  "value": "123"
                }
              ]
            },
            "description": "Отвязать лицо от персоны (сделать неназначенным)"
          }
        },
        {
          "name": "Auto-Assign Faces to Person",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/persons/:person_id/auto-assign?threshold=0.6",
              "host": ["{{base_url}}"],
              "path": ["persons", ":person_id", "auto-assign"],
              "query": [
                {
                  "key": "threshold",
                  "value": "0.6",
                  "description": "Порог сходства для авто-привязки (0.4-0.9)"
                }
              ],
              "variable": [
                {
                  "key": "person_id",
                  "value": "1"
                }
              ]
            },
            "description": "Автоматически привязать похожие неназначенные лица к персоне"
          }
        }
      ]
    },
    {
      "name": "Combined Search",
      "item": [
        {
          "name": "Search Person with CLIP",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"person_id\": 1,\n  \"query\": \"в горах\",\n  \"top_k\": 20,\n  \"translate\": true,\n  \"model\": \"SigLIP\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/search/person-clip",
              "host": ["{{base_url}}"],
              "path": ["search", "person-clip"]
            },
            "description": "Комбинированный поиск: найти фотографии с конкретным человеком, соответствующие текстовому описанию. Например: 'Таня в горах'"
          }
        }
      ]
    },
    {
      "name": "Map API",
      "item": [
        {
          "name": "Get Map Stats",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/map/stats",
              "host": ["{{base_url}}"],
              "path": ["map", "stats"]
            },
            "description": "Статистика по гео-данным: количество фото с GPS, диапазон дат, географические границы"
          }
        },
        {
          "name": "Get Map Clusters",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"min_lat\": 40.0,\n  \"max_lat\": 60.0,\n  \"min_lon\": 20.0,\n  \"max_lon\": 50.0,\n  \"zoom\": 5,\n  \"date_from\": \"2020-01-01\",\n  \"date_to\": \"2025-12-31\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/map/clusters",
              "host": ["{{base_url}}"],
              "path": ["map", "clusters"]
            },
            "description": "Получить кластеры фотографий для карты. Кластеризация на сервере в зависимости от zoom level."
          }
        },
        {
          "name": "Get Photos in Area",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/map/photos?min_lat=40.0&max_lat=50.0&min_lon=20.0&max_lon=40.0&limit=100&offset=0",
              "host": ["{{base_url}}"],
              "path": ["map", "photos"],
              "query": [
                {"key": "min_lat", "value": "40.0"},
                {"key": "max_lat", "value": "50.0"},
                {"key": "min_lon", "value": "20.0"},
                {"key": "max_lon", "value": "40.0"},
                {"key": "limit", "value": "100"},
                {"key": "offset", "value": "0"}
              ]
            },
            "description": "Получить фотографии в заданном bounding box с пагинацией"
          }
        },
        {
          "name": "Search in Geographic Area",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"море и пляж\",\n  \"top_k\": 20,\n  \"translate\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/map/search?min_lat=30.0&max_lat=50.0&min_lon=20.0&max_lon=45.0",
              "host": ["{{base_url}}"],
              "path": ["map", "search"],
              "query": [
                {"key": "min_lat", "value": "30.0"},
                {"key": "max_lat", "value": "50.0"},
                {"key": "min_lon", "value": "20.0"},
                {"key": "max_lon", "value": "45.0"}
              ]
            },
            "description": "Текстовый поиск в пределах географической области. Комбинирует CLIP поиск с гео-фильтрацией."
          }
        }
      ]
    },
    {
      "name": "Geo Assignment API",
      "item": [
        {
          "name": "Get Geo Stats",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/geo/stats",
              "host": ["{{base_url}}"],
              "path": ["geo", "stats"]
            },
            "description": "Статистика по фото без GPS: total_photos, with_gps, without_gps, gps_percentage"
          }
        },
        {
          "name": "Get Folders Without GPS",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/geo/folders?formats=nef",
              "host": ["{{base_url}}"],
              "path": ["geo", "folders"],
              "query": [
                {
                  "key": "formats",
                  "value": "nef",
                  "description": "Фильтр по форматам файлов (jpg,heic,png,nef)"
                }
              ]
            },
            "description": "Список папок с фото без GPS координат. Возвращает путь и количество фото в каждой папке. Можно фильтровать по формату."
          }
        },
        {
          "name": "Get Photos Without GPS",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/geo/photos?folder=/photos/СЕМЬЯ/Trip 2024&formats=jpg,heic&limit=200&offset=0",
              "host": ["{{base_url}}"],
              "path": ["geo", "photos"],
              "query": [
                {
                  "key": "folder",
                  "value": "/photos/СЕМЬЯ/Trip 2024",
                  "description": "Фильтр по папке (опционально)"
                },
                {
                  "key": "formats",
                  "value": "jpg,heic",
                  "description": "Фильтр по форматам файлов (jpg,heic,png,nef)"
                },
                {
                  "key": "limit",
                  "value": "200",
                  "description": "Максимальное количество фото"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "description": "Смещение для пагинации"
                }
              ]
            },
            "description": "Получить фото без GPS координат. Можно фильтровать по папке и формату."
          }
        },
        {
          "name": "Assign GPS Coordinates",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"image_ids\": [123, 456, 789],\n  \"latitude\": 54.542219,\n  \"longitude\": 16.535712\n}\n\n// OR assign all photos in folder (no GPS yet)\n{\n  \"folder\": \"/photos/СЕМЬЯ/Baltika 2025\",\n  \"formats\": [\"jpg\", \"heic\"],\n  \"latitude\": 54.542219,\n  \"longitude\": 16.535712\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/geo/assign",
              "host": ["{{base_url}}"],
              "path": ["geo", "assign"]
            },
            "description": "Привязать GPS координаты к выбранным фото или ко всей папке (только фото без GPS). Используется для ручной привязки координат из UI geo_assign.html"
          }
        }
      ]
    }
  ]
}
